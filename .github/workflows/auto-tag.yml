name: Auto Tag and Release

on:
  push:
    branches:
      - main  # Trigger on push to main branch

jobs:
  auto-tag:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Fetch all history for proper versioning

    - name: Bump version and push tag
      id: tag_version
      uses: mathieudutour/github-tag-action@v6.2
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        default_bump: patch  # Default to patch if no keyword found
        release_branches: main
        # Version bump based on commit message:
        # - "fix:" or "patch:" -> patch (1.0.0 -> 1.0.1)
        # - "feat:" or "minor:" -> minor (1.0.0 -> 1.1.0)  
        # - "major:" or "BREAKING CHANGE:" -> major (1.0.0 -> 2.0.0)
        # - "chore:", "docs:", etc. -> no bump (optional)

    - name: Create GitHub Release
      if: steps.tag_version.outputs.new_tag != ''
      uses: ncipollo/release-action@v1
      with:
        tag: ${{ steps.tag_version.outputs.new_tag }}
        name: Release ${{ steps.tag_version.outputs.new_tag }}
        body: |
          ## Changes in this release
          ${{ steps.tag_version.outputs.changelog }}
          
          ### Installation
          Download the `Thermal-Engine-Windows.zip` from the Assets below.
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
